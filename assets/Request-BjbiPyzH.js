import{a7 as A,a8 as B,a9 as I,d as R,r as n,c as g,o as v,w as s,a as r,k as L,b as _,u as t,e as i,F as $,t as b,N as h,g as P,_ as E}from"./app-CGYE_ff5.js";import{N as M}from"./Checkbox-BT94wIZM.js";import{B as N}from"./Button-t-jNHo83.js";import{N as q}from"./Input-B1Dsgi5V.js";import{N as C}from"./Alert-D6U2FzjU.js";import{N as O}from"./Image-v1vWoWMK.js";function Q(){const y=A(B,null);return y===null&&I("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),y}const z="https://alist.nn.ci/tool/aliyundrive/callback",T="76917ccccd4441c39457a04f6084fb2f",V=R({__name:"Request",setup(y){function U(){const a=new URL("https://open.aliyundrive.com/oauth/authorize");a.searchParams.set("client_id",u.value?c.value:T),a.searchParams.set("redirect_uri",z),a.searchParams.set("scope","user:base,file:all:read,file:all:write"),a.searchParams.set("response_type","code"),a.searchParams.set("state",window.btoa(u.value?`${c.value}::${f.value}`:"::")),a.searchParams.set("relogin","true"),window.open(a.toString(),"_blank")}const o=n(),w=n(!1),c=n(""),f=n(""),u=n(!1);async function x(){try{w.value=!0;const e=await(await fetch(P()+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value?{client_id:c.value,client_secret:f.value}:{})})).json();o.value=e}catch(a){console.log(a),o.value={error:"error",qrCodeUrl:"",sid:""}}finally{w.value=!1}}const m=n(),k=n(!1),S=Q();async function j(){var a;try{k.value=!0;const l=await(await fetch(`${P()}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(a=o.value)==null?void 0:a.sid}/status`)).json();if(m.value=l,l.status==="LoginSuccess"){const d=new URL(z);d.searchParams.set("code",l.authCode),window.open(d.toString(),"_blank")}else S.warning(l.status)}catch(e){console.log(e),S.error(String(e))}finally{k.value=!1}}return(a,e)=>(v(),g(t(h),{vertical:"",size:"large"},{default:s(()=>{var l,d;return[r(t(M),{checked:u.value,"onUpdate:checked":e[0]||(e[0]=p=>u.value=p),size:"large"},{default:s(()=>e[3]||(e[3]=[i("使用自己的客户端信息")])),_:1,__:[3]},8,["checked"]),u.value?(v(),L($,{key:0},[r(t(q),{size:"large",value:c.value,"onUpdate:value":e[1]||(e[1]=p=>c.value=p),placeholder:"client_id"},null,8,["value"]),r(t(q),{size:"large",value:f.value,"onUpdate:value":e[2]||(e[2]=p=>f.value=p),placeholder:"client_secret"},null,8,["value"])],64)):_("",!0),r(t(N),{size:"large",type:"primary",onClick:U,block:""},{default:s(()=>e[4]||(e[4]=[i("前往登录")])),_:1,__:[4]}),r(t(N),{size:"large",type:"info",onClick:x,block:"",loading:w.value,disabled:!!o.value},{default:s(()=>e[5]||(e[5]=[i("扫描二维码 ")])),_:1,__:[5]},8,["loading","disabled"]),(l=o.value)!=null&&l.error?(v(),g(t(C),{key:1,title:"Error",type:"error"},{default:s(()=>[i(b(o.value.error),1)]),_:1})):_("",!0),(d=o.value)!=null&&d.qrCodeUrl?(v(),g(t(h),{key:2,vertical:""},{default:s(()=>[r(t(h),{justify:"center"},{default:s(()=>[r(t(O),{width:"300",src:o.value.qrCodeUrl},null,8,["src"])]),_:1}),r(t(C),{title:"扫描二维码",type:"info"},{default:s(()=>e[6]||(e[6]=[i("使用 AliyunDrive APP 扫描，然后点击下方按钮")])),_:1,__:[6]}),r(t(N),{size:"large",onClick:j,type:"info",block:"",loading:k.value},{default:s(()=>e[7]||(e[7]=[i("已扫码")])),_:1,__:[7]},8,["loading"])]),_:1})):_("",!0),m.value&&m.value.status!=="LoginSuccess"?(v(),g(t(C),{key:3,title:"Warning",type:"warning"},{default:s(()=>[i(b(m.value.status),1)]),_:1})):_("",!0)]}),_:1}))}}),H=E(V,[["__scopeId","data-v-8e7a8aea"]]);export{H as R};
